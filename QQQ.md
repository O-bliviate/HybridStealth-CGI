## 3. HybridStealth-CGI 方法论



### 3.1 威胁模型

HybridStealth-CGI建立在以下威胁模型之上：

- **攻击者**：系统中存在多个恶意且相互合谋的服务器。它们的共同目标是重建特定目标客户端的私有训练数据。
- **攻击者能力**：
  1. **模型操控**：攻击者（服务器）有能力在将全局模型分发给客户端之前，对其架构和参数进行篡改，以植入恶意组件。这是实现攻击的前提。
  2. **合谋通信**：攻击者之间可以建立通信渠道，但该渠道必须是隐蔽的，以避免系统监控机制发现。
  3. **系统知识**：攻击者完全了解联邦学习协议（如FedAVG）、模型结构以及安全聚合机制。
- **防御设置**：系统采用安全聚合作为核心防御手段。这意味着服务器在每个训练轮次结束时，只能接收到一组客户端模型更新的加密聚合结果，而无法获得任何单个客户端的更新。
- **客户端假设**：客户端是诚实的，即它们会忠实地按照协议使用本地数据训练接收到的模型，并将更新返回给服务器。客户端不具备检测模型是否被恶意篡改的能力（或此能力有限）。

### 3.2 总体攻击框架

HybridStealth-CGI的攻击流程是一个精心设计的两阶段管道。该框架将攻击过程解耦为两个核心阶段：解析初始化和隐蔽优化，以实现“快速定位、精细重建”和“隐匿行踪”的目标。

- **阶段一（解析初始化）**：在此阶段，攻击者设计可解析恶意模块（PMM），从经过安全聚合的梯度中，快速解析出目标数据X的一个低维轮廓 \($ X_{low}$ \)。此轮廓虽不精确，但包含了数据的关键结构和特征信息。
- **阶段二（隐蔽优化）**：在此阶段，攻击者将第一阶段得到的轮廓 \( $ X_{low}$ ) 作为强初始化信号，输入一个经过改进的合谋优化流程。该流程通过基于参数微调的隐值（PTC）进行协调，最终重建出高保真度的数据 \( $X_{recon}$ \)。

### 3.3 阶段一：抗安全聚合的解析初始化

本阶段的核心目标是突破安全聚合的防御。

#### 3.3.1 可解析恶意模块设计

可解析恶意模块（Parsable Malicious Module, PMM）的设计目标是：构造一个神经网络层，使其权重的梯度与输入数据之间建立一种稳定、可逆的数学关系，并且这种关系在梯度聚合后依然能够被利用。这本质上是在模型的正常计算图中嵌入一个“后门”，使得梯度不仅服务于模型优化，更直接编码了输入数据的信息。

##### 1. 设计核心：建立梯度与数据的线性映射

PMM通常被实现为一个定制化的全连接层（Fully Connected Layer）。其核心思想源于一个简单的线性代数原理：对于一个线性层，其权重梯度与输入数据之间存在直接的线性关系。

- **前向传播**：

  设输入到此模块的数据为 \( $X \in \mathbb{R}^{B \times D_{in}}$ \)，其中 \( B \) 是批次大小（Batch Size），\( D_{in} \) 是输入特征的维度（例如，对于一张图像，\( D_{in} = \) 通道数×高度×宽度）。PMM模块的权重为
  $ W_{pmm} \in \mathbb{R}^{D_{in} \times D_{out}}$
  偏置为 $b_{pmm} \in \mathbb{R}^{D_{out}} $（为简化分析，有时可忽略偏置）。前向传播公式为：
  $Z = XW_{pmm} + b_{pmm}$
  其中 $Z \in \mathbb{R}^{B \times D_{out}} $ 是模块的输出。

- **反向传播与梯度形成**：

  在训练过程中，根据链式法则，损失函数 \( L \) 对权重 $ W_{pmm} $ 的梯度为：
  $
  \nabla W_{pmm} = \frac{\partial \mathcal{L}}{\partial W_{pmm}} = X^T \cdot \frac{\partial C}{\partial Z}
  $
  这里，$ \frac{\partial \mathcal{L}}{\partial Z} \in \mathbb{R}^{B \times D_{out}} $是损失函数对输出 \( Z \) 的梯度，是从上游反向传播回来的。$X^T \in \mathbb{R}^{D_{in} \times B} $是输入数据的转置。

  关键：公式 $\nabla W_{pmm} = X^T \cdot \frac{\partial \mathcal{L}}{\partial Z}$表明，权重梯度$\nabla W_{pmm}$ 是输入数据 \(X\) 的线性函数。

##### 2. 控制梯度，实现稳定解析

上述线性关系是普遍存在的，但要使它对于数据解析有用，必须控制 $ \frac{\partial \mathcal{L}}{\partial Z} $。如果 $ \frac{\partial \mathcal{L}}{\partial Z} $ 是一个不可预测的复杂变量，那么从 $\nabla W_{pmm}$ 中稳定地反推 \(X\) 将非常困难。

因此，PMM的设计包含一个损失函数工程环节：

攻击者构造一个特定的损失函数 $ \mathcal{L}_{pmm} $，附加在 PMM 模块的输出 \(Z\) 上。这个损失函数的目标是迫使 \(Z\) 逼近一个固定的、已知的目标矩阵 \(T\)。例如，可以使用均方误差损失：
$
\mathcal{L}_{pmm} = \frac{1}{2} \| Z - T \|_F^2
$
其中 $ \| \cdot \| $是 Frobenius 范数。在这种情况下，对 \(Z\) 的梯度就变得非常简单且恒定：
$$
\frac{\partial \mathcal{L}_{pmm}}{\partial Z} = Z - T
$$
通过精心设置初始权重和目标 \(T\)，攻击者可以使在攻击发起的初始阶段，$\frac{\partial \mathcal{L}_{pmm}}{\partial Z} \approx C$，其中 \(C\) 是一个常数矩阵或具有稳定统计特性的矩阵。

最终效果：当$\frac{\partial \mathcal{L}}{\partial Z} \approx C$时，权重梯度的公式简化为：$\nabla W_{pmm} \approx X^TC$

这就建立了一个稳定、可逆的线性映射关系。攻击者已知 \(C\)，并且通过安全聚合获得了 $\nabla W_{pmm}^{agg}$，因此可以尝试求解 \(X\)。

##### 3. 模块的隐蔽性与兼容性

PMM的设计必须考虑不被客户端怀疑。

- **功能伪装**： PMM层在正常的前向传播中，其计算与标准全连接层无异，不会影响模型的主要任务（如分类）精度，从而难以被功能测试检测。
- **参数伪装**： 权重 Wpmm的初始化值可以设置为看似合理的值（如Xavier或Kaiming初始化），而不是全1矩阵，以规避简单的参数检查。只要其与矩阵 C 的结合能产生可解析的梯度即可。

通过以上设计，PMM模块成功地将输入数据 X 的线性变换“编码”到了其权重梯度 $\nabla W_{pmm}$中，为后续在安全聚合环境下解析数据轮廓奠定了坚实的基础。这种将攻击逻辑嵌入模型基础构件的方式，体现了HybridStealth-CGI攻击的深度和精巧性。

#### 3.3.2 抗聚合解析过程：从聚合梯度中分离目标数据

本小节的目标是解决一个核心问题：给定聚合梯度 $\nabla W_{pm}^{agg} = \sum_{i=1}^{N}(X^{i})^{T}C$，如何恢复出特定目标客户端 的数据 Xi 的近似表示 $X_{low}^{t}$

**盲源分离**

##### 步骤一：全局轮廓提取

首先，从聚合梯度中计算所有客户端数据的平均轮廓。由于假设 VZ=C 是一个常数矩阵，且 C 是已知的（由攻击者设计的损失函数决定），可以通过**伪逆** 操作来估计所有输入数据的和。
$$
\sum_{i=1}^{N}(X^{i})^{T} \approx \nabla W_{pmm}^{agg} \cdot C^{+}
$$

其中 \(C^{+}\) 是矩阵 C 的 Moore-Penrose 伪逆。由此，得到了一个聚合数据矩阵 $\hat{X}_{agg} = (\nabla W_{pmm}^{agg} \cdot C^{+})^{T}$，其维度为 B，其中 (B* D) 是所有客户端批次大小之和。

##### 步骤二：目标信号分离（关键步骤）

从混合信号 $\hat{X}_{agg}$ 中分离出目标客户端 的贡献。借鉴 LOKI 论文中的“身份映射集”思想，并将其与**稀疏性假设**相结合。

- **LOKI 思想的借鉴与改造**： 在 LOKI 中，通过为每个客户端分配独特的卷积核来实现梯度分离。在的方案中，PMM层扮演了类似角色。通过设计 PMM 层的权重 $W_{pmm}$，使其对不同的输入数据产生可区分的“指纹”。
- **具体实现**： 可以将 $W_{pmm}$ 设计为一个**块对角矩阵** 或使其不同列具有显著不同的统计特性。这样，目标客户端数据 X 在 PMM 层输出的特定通道子集上会有更强的激活。在梯度 $\nabla W^{agg}_{pmm}$ 中，对应于这些特定通道的列会更多地包含 \(X_t\) 的信息。
- **过程**：通过分析 $\nabla W^{agg}_{pmm}$ 各列的能量（Frobenius范数）或统计分布，可以识别出哪些列主要由目标客户端的数据主导。这相当于在混合信号中找到了目标信号的“专属频段”。
- **利用稀疏性与独立成分分析**：假设不同客户端的数据在某种变换域（例如，离散余弦变换DCT域或小波域）上是稀疏的，并且统计独立。可以对提取出的、含目标信息的梯度列应用独立成分分析 或非负矩阵分解等源分离算法，尝试将 $\hat{X}_{agg}$ 分解为若干成分，其中与目标客户端数据分布最匹配的成分即为 $X^t_{low}$。

##### 步骤三：逆问题求解与轮廓重构

在步骤二中，得到了目标数据的一个混合或低秩估计。现在，需要通过求解一个逆问题来重构出数据本身。

- 目标是从关系式 $\nabla W^{agg}_{pmm} \approx (X^t)^T C$+其他客户端的贡献, 中求解 \(X^t\). 由于其他客户端的贡献被视为噪声，这可以建模为一个线性逆问题。

- **正则化方法**：为了获得稳定的解，引入正则化项，并求解以下优化问题：
  $$
  \min_{X^t} \| \nabla W^{agg}_{pmm} - (X^t)^T C \|_F^2 + \lambda R(X^t)
  $$
  其中：
  
  - $R(X^t)$ 是正则化项，例如：
    - **总变差正则化**：用于促进图像平滑，抑制噪声。
    - **L1正则化**：用于促进稀疏性，假设图像在某个变换域是稀疏的。
  - $\lambda $ 是正则化系数。
  
- **迭代优化**：上述优化问题可以使用迭代算法（如梯度下降或ADMM）求解。求解得到的 \(X\) 就是最终解析出的目标客户端数据的低维轮廓 $X^t_{low}$。由于噪声和模型误差，$X^t_{low}$可能是模糊的，但它已经包含了足够多的语义信息，为第二阶段的优化提供了初始化。



### 3.4 阶段二：基于隐信道的隐蔽合谋优化

本阶段的核心目标是在不被检测的情况下，协调多个服务器共同完成高质量的数据重建。

#### 3.4.1 PTC² 隐信道通信机制

PTC²信道的创新在于将合谋信息隐藏在合法的模型参数更新中。

- **编码过程**：主服务器将需要共享的信息 m（例如，解析出的数据轮廓$X^t_{low}$ 的哈希值，或当前虚拟数据 \( $\tilde{D}$  \) 的版本号）转换为二进制位流。随后，它选择全局模型中的某些参数（如某一层的偏置项），将这些参数的最低有效位（LSB）替换为信息 m 的位流。例如，将一个32位浮点数参数的最后8位用于编码。这种微调对模型性能的影响远低于训练噪声，难以察觉。
- **解码与同步**：其他合谋服务器在接收到新一轮的全局模型后，从预先约定的参数LSB中提取出二进制位流，并解码出信息 m。由此，所有合谋方在不进行任何显式网络通信的情况下，实现了虚拟数据状态或攻击策略的同步。

#### 3.4.2 改进的纳什博弈优化流程

在此阶段，优化过程如下：

1. **强初始化**：各合谋服务器使用通过PTC²信道同步的 $X^t_{low}$ 来初始化其虚拟数据 \( $\tilde{D}$ \)，而非随机初始化。
2. **本地梯度计算**：每个服务器 $ S_k $ 在其任务模型上计算虚拟数据产生的梯度 $\tilde{g}_k$。
3. **通过PTC²的信道协调**：各服务器通过PTC²信道交换其本地效用信息（如 $g_k$ 的范数或方向摘要），而非原始梯度数据。
4. **权重聚合与更新**：基于交换的摘要信息，服务器们运行纳什博弈算法 ，计算出聚合权重 $a_k$。随后，生成聚合梯度更新 $\tilde{g} = \sum_k a_k \tilde{g}_k$，并用于更新虚拟数据 \( $\tilde{D}$ \)。此过程循环迭代，直至虚拟数据收敛。

### 3.5 隐蔽性与鲁棒性分析 

**隐蔽性分析**：PTC²信道的通信流量完全包含在正常的模型更新中，通信流量为零。参数LSB 的变化与训练过程中自然产生的数值波动无异，使得基于流量分析、定时分析或模型更新异 常检测的方法极难生效。

 **鲁棒性分析**：PMM模块对梯度噪声具有一定的容忍度。即使客户端应用了梯度裁剪或添加了 中等强度的噪声，只要 的统计特性未被完全破坏，解析出的 仍能提供比随机初始 化远为优越的起点，从而确保优化过程能够有效收敛，显示出强大的抗干扰能力。

